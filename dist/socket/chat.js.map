{"version":3,"sources":["../../src/socket/chat.ts"],"names":["chat","io","on","socket","console","log","Date","toUTCString","sesName","obj","name","id","username","mapped","forEach","val","to","SocketId","emit","message"],"mappings":";;;;;;;AACA;;;;;;AAEe,SAASA,IAAT,CAAcC,EAAd,EAAyC;AACtDA,EAAAA,EAAE,CAACC,EAAH,CAAM,YAAN,EAAoB,UAAAC,MAAM,EAAI;AAC5BC,IAAAA,OAAO,CAACC,GAAR,CACE,MACE,IAAIC,IAAJ,GAAWC,WAAX,EADF,GAEE,IAFF,kDADF;AAMA,QAAIC,OAAO,GAAG,EAAd;AACAL,IAAAA,MAAM,CAACD,EAAP,CAAU,UAAV,EAAsB,UAAAO,GAAG,EAAI;AAC3BL,MAAAA,OAAO,CAACC,GAAR,CACE,MACE,IAAIC,IAAJ,GAAWC,WAAX,EADF,GAEE,IAFF,wBAGgBE,GAAG,CAACC,IAHpB,4BAG0CP,MAAM,CAACQ,EAHjD,CADF;AAMAH,MAAAA,OAAO,GAAGC,GAAG,CAACC,IAAd;AACA,6BAAUD,GAAG,CAACC,IAAd,EAAoBP,MAAM,CAACQ,EAA3B;AACD,KATD;AAWAR,IAAAA,MAAM,CAACD,EAAP,CAAU,OAAV;AAAA;AAAA;AAAA;AAAA;AAAA,8BAAmB,iBAAMO,GAAN;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,uBACW,qBAAQA,GAAG,CAACG,QAAZ,CADX;;AAAA;AACXC,gBAAAA,MADW;AAEjBA,gBAAAA,MAAM,CAACC,OAAP,CAAe,UAAAC,GAAG,EAAI;AACpBd,kBAAAA,EAAE,CAACe,EAAH,WAASD,GAAG,CAACE,QAAb,GAAyBC,IAAzB,CAA8B,KAA9B,EAAqCT,GAAG,CAACU,OAAzC;AACD,iBAFD;;AAFiB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OAAnB;;AAAA;AAAA;AAAA;AAAA;AAOAhB,IAAAA,MAAM,CAACD,EAAP,CAAU,YAAV,EAAwB;AAAA,aACtBE,OAAO,CAACC,GAAR,CACE,MACE,IAAIC,IAAJ,GAAWC,WAAX,EADF,GAEE,IAFF,wBAGgBC,OAAO,GAAGA,OAAH,GAAa,SAHpC,kBADF,CADsB;AAAA,KAAxB;AAQD,GAlCD;AAmCD","sourcesContent":["import socketio from \"socket.io\"\nimport { insertNew, mapping } from \"../databases/usn-map\"\n\nexport default function chat(io: socketio.Server): void {\n  io.on(\"connection\", socket => {\n    console.log(\n      \"[\" +\n        new Date().toUTCString() +\n        \"] \" +\n        `[SocketIO] Someone has established connection`,\n    )\n    let sesName = \"\"\n    socket.on(\"tellname\", obj => {\n      console.log(\n        \"[\" +\n          new Date().toUTCString() +\n          \"] \" +\n          `[SocketIO] ${obj.name} has joined as ${socket.id}`,\n      )\n      sesName = obj.name\n      insertNew(obj.name, socket.id)\n    })\n\n    socket.on(\"msgTo\", async obj => {\n      const mapped: any[] = await mapping(obj.username)\n      mapped.forEach(val => {\n        io.to(`${val.SocketId}`).emit(\"msg\", obj.message)\n      })\n    })\n\n    socket.on(\"disconnect\", () =>\n      console.log(\n        \"[\" +\n          new Date().toUTCString() +\n          \"] \" +\n          `[SocketIO] ${sesName ? sesName : \"Someone\"} disconnected`,\n      ),\n    )\n  })\n}\n"],"file":"chat.js"}