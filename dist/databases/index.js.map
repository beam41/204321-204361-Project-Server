{"version":3,"sources":["../../src/databases/index.ts"],"names":["sql","sqlite3","verbose","db","Database","process","env","DB","err","console","error","colors","red","message","log","green","Date","toUTCString","exec","runDB","serialize","run"],"mappings":";;;;;;;;AAAA;;AACA;;;;AAEA,IAAMA,GAAG,GAAGC,mBAAQC,OAAR,EAAZ;;AAEO,IAAMC,EAAE,GAAG,IAAIH,GAAG,CAACI,QAAR,CAAiBC,OAAO,CAACC,GAAR,CAAYC,EAA7B,EAAiC,UAAAC,GAAG,EAAI;AACxD,MAAIA,GAAJ,EAASC,OAAO,CAACC,KAAR,CAAcC,iBAAOC,GAAP,CAAWJ,GAAG,CAACK,OAAf,CAAd,EAAT,KAEEJ,OAAO,CAACK,GAAR,CACEH,iBAAOI,KAAP,CACE,MACE,IAAIC,IAAJ,GAAWC,WAAX,EADF,GAEE,IAFF,GAGE,uCAJJ,CADF;AAQH,CAXiB,CAAX,C,CAYP;;;AACAd,EAAE,CAACe,IAAH,CAAQ,uBAAR;;AAEO,SAASC,KAAT,GAAiB;AACtBhB,EAAAA,EAAE,CAACiB,SAAH,CAAa,YAAM;AACjBjB,IAAAA,EAAE,CAACkB,GAAH,4OAUE,UAAAb,GAAG,EAAI;AACL,UAAIA,GAAJ,EAASC,OAAO,CAACC,KAAR,CAAcC,iBAAOC,GAAP,CAAWJ,GAAG,CAACK,OAAf,CAAd;AACV,KAZH;AAcAV,IAAAA,EAAE,CAACkB,GAAH,kcAeE,UAAAb,GAAG,EAAI;AACL,UAAIA,GAAJ,EAASC,OAAO,CAACC,KAAR,CAAcC,iBAAOC,GAAP,CAAWJ,GAAG,CAACK,OAAf,CAAd;AACV,KAjBH;AAmBAV,IAAAA,EAAE,CAACkB,GAAH,4NASE,UAAAb,GAAG,EAAI;AACL,UAAIA,GAAJ,EAASC,OAAO,CAACC,KAAR,CAAcC,iBAAOC,GAAP,CAAWJ,GAAG,CAACK,OAAf,CAAd;AACV,KAXH;AAaAV,IAAAA,EAAE,CAACkB,GAAH,ujBAkBE,UAAAb,GAAG,EAAI;AACL,UAAIA,GAAJ,EAASC,OAAO,CAACC,KAAR,CAAcC,iBAAOC,GAAP,CAAWJ,GAAG,CAACK,OAAf,CAAd;AACV,KApBH;AAsBAV,IAAAA,EAAE,CAACkB,GAAH,ifAgBE,UAAAb,GAAG,EAAI;AACL,UAAIA,GAAJ,EAASC,OAAO,CAACC,KAAR,CAAcC,iBAAOC,GAAP,CAAWJ,GAAG,CAACK,OAAf,CAAd;AACV,KAlBH;AAoBD,GAzFD;AA0FD","sourcesContent":["import sqlite3 from \"sqlite3\"\nimport colors from \"colors/safe\"\n\nconst sql = sqlite3.verbose()\n\nexport const db = new sql.Database(process.env.DB, err => {\n  if (err) console.error(colors.red(err.message))\n  else\n    console.log(\n      colors.green(\n        \"[\" +\n          new Date().toUTCString() +\n          \"] \" +\n          \"[SQLite] Connected to the database :)\",\n      ),\n    )\n})\n// just in case it was turned off once\ndb.exec(\"PRAGMA synchronous=ON\")\n\nexport function runDB() {\n  db.serialize(() => {\n    db.run(\n      `\n    CREATE TABLE IF NOT EXISTS ADVISOR (\n      AdvisorID   CHARACTER(9)    NOT NULL    UNIQUE,\n      AdvName     TEXT,\n      AdvSurname  TEXT,\n      Password    TEXT,\n      PRIMARY KEY (AdvisorID)\n    ) WITHOUT ROWID;\n    `,\n      err => {\n        if (err) console.error(colors.red(err.message))\n      },\n    )\n    db.run(\n      `\n    CREATE TABLE IF NOT EXISTS STUDENT (\n      StudentID   CHARACTER(9)    NOT NULL    UNIQUE,\n      StdName     TEXT,\n      StdSurname  TEXT,\n      AdvisorID   CHARACTER(9)    NOT NULL    DEFAULT 'A0',\n      Password    TEXT,\n      PerFailed   REAL,\n      PRIMARY KEY (StudentID),\n      FOREIGN KEY (AdvisorID)     REFERENCES  ADVISOR (AdvisorID)\n      ON DELETE   SET DEFAULT\n      ON UPDATE   CASCADE\n    )   WITHOUT ROWID;\n    `,\n      err => {\n        if (err) console.error(colors.red(err.message))\n      },\n    )\n    db.run(\n      `\n    CREATE TABLE IF NOT EXISTS COURSE (\n      CourseID      CHARACTER(6)    NOT NULL    UNIQUE,\n      CourseName    TEXT,\n      CourseCredit  INTEGER,\n      PRIMARY KEY (CourseID)\n    )   WITHOUT ROWID;\n    `,\n      err => {\n        if (err) console.error(colors.red(err.message))\n      },\n    )\n    db.run(\n      `\n    CREATE TABLE IF NOT EXISTS STDPLAN (\n      StudentID   CHARACTER(9)    NOT NULL,\n      CourseID    CHARACTER(6)    NOT NULL,\n      Year        INTEGER,\n      Term        INTEGER,\n      Grade       CHARACTER(2),\n      EditedGrade CHARACTER(2),\n      PRIMARY KEY (StudentID, CourseID, Year, Term)\n      FOREIGN KEY (StudentID)     REFERENCES  STUDENT (StudentID)\n      ON DELETE   CASCADE\n      ON UPDATE   CASCADE\n      FOREIGN KEY (CourseID)      REFERENCES  COURSE  (CourseID)\n      ON DELETE   CASCADE\n      ON UPDATE   CASCADE\n    );\n    `,\n      err => {\n        if (err) console.error(colors.red(err.message))\n      },\n    )\n    db.run(\n      `\n    CREATE TABLE IF NOT EXISTS CHAT (\n      ChatID      INTEGER         NOT NULL    UNIQUE,\n      StudentID   CHARACTER(9)    NOT NULL,\n      AdvisorID   CHARACTER(9)    NOT NULL,\n      Time        INTEGER,\n      Message     TEXT,\n      SentBy      TEXT,\n      PRIMARY KEY (ChatID)\n      FOREIGN KEY (StudentID)     REFERENCES  STUDENT (StudentID)\n      FOREIGN KEY (AdvisorID)     REFERENCES  ADVISOR (AdvisorID)\n      ON DELETE   CASCADE\n      ON UPDATE   CASCADE\n    );\n    `,\n      err => {\n        if (err) console.error(colors.red(err.message))\n      },\n    )\n  })\n}\n"],"file":"index.js"}